feasibility_check:
  description: >
    Analyze if the requested trip is financially realistic.
    inputs: Source: {origin}, Destination: {destination}, Budget: {budget}, Travelers: {travelers}, Days: {days}, Travel Style: {travel_style}.

    LOGIC:
    1. Estimate rough travel cost per person from {origin} to {destination} (round trip).
       - If Source == Destination, Travel Cost = 0.
       - Assume conservative flight prices.
    2. Subtract (Travel Cost * Travelers) from {budget}.
    3. Divide the remaining amount by ({days} * {travelers}) to get "Daily Spend Per Person".
    4. DECISION:
       - IF Daily Spend < 500 INR (or equivalent currency): FAIL (Only if absolutely impossible).
         * REQUIREMENT: In the 'message' field, explicitly state "Your budget is extremely low." 
         * REQUIREMENT: Calculate and provide the "Minimum Suggested Budget".
       - IF Daily Spend >= 500 INR: PASS.
       - NOTE: Be lenient. If it's close, Mark as FEASIBLE. Do not be strict.
  expected_output: >
    JSON Object:
    {
      "is_feasible": boolean,
      "reason": "Reason for failure or success",
      "estimated_travel_cost": number,
      "daily_spend_per_person": number,
      "daily_spend_per_person": number,
      "message": "User friendly message explaining failure or success. IF FAILED, INCLUDE 'Minimum Budget Allowed: XXXXX'",
      "minimum_suggested_budget": number
    }
  agent: budget_guardian

identify_optimal_route_task:
  description: >
    Analyze the following list of destinations: {destinations}.
    Your goal is to determine the MOST OPTIMAL order to visit these cities.
    
    CRITICAL REQUIREMENTS:
    1. BUDGET: Compare travel costs between the cities and recommend the sequence that minimizes transit expenses.
    2. EVENTS: Research if there are any specific festivals, events, or "good things happening" in these cities starting from {current_date} for {days} days. If an event is time-sensitive, prioritize visiting that city on those dates.
    3. LOGISTICS: Factor in geographical proximity to reduce travel time.
    
    Provide a clear rationale for WHY you chose this specific order (e.g., 'Visiting City A first saves $200 in flights' or 'City B has a festival on day 2').
  expected_output: >
    An optimized route sequence with a detailed explanation of why this order was chosen based on budget, events, and logistics.
  agent: travel_coordinator_agent


plan_multi_city_itinerary_task:
  description: >
    Based on the OPTIMAL ROUTE provided in the previous task, create a comprehensive day-by-day itinerary 
    that covers ALL cities listed. Do not skip any city.
    Ensure smooth transitions between cities and include suggested transport modes.
    
    CRITICAL: You MUST generate a detailed plan for EXACTLY {days} DAYS.
    Do NOT summarize or group days (e.g., "Days 3-5"). Write out Day 1, Day 2, Day 3, ... Day {days} individually.
    If {days} is 5, you must provide 5 distinct daily plans.
    Note: {days} is the total trip duration, distribute days wisely among cities.
  expected_output: >
    A full, multi-city day-by-day itinerary including all destinations in the optimized order.
  agent: itinerary_specialist_agent
  context: [identify_optimal_route_task]

enrichment_task:
  description: >
    STEP 1: Check the 'feasibility_check' output. IF 'is_feasible' is false, RETURN THE ERROR JSON immediately.

    IF feasible:
    Take the rough route provided by the Route Planner and fill in specific, engaging activities 
    that match the user's Travel Style: {travel_style}.
    Use your internal knowledge to suggest highly-rated places.
    Assume typical weather for the season.
  expected_output: >
    A detailed itinerary with specific place names and descriptions OR the error JSON.
  agent: local_guide
  context: [plan_multi_city_itinerary_task]

hotel_task:
  description: >
    STEP 1: Check the 'feasibility_check' output. IF 'is_feasible' is false, RETURN THE ERROR JSON immediately.

    IF feasible:
    Search for and list at least 5 distinct accommodation options in {destination}.
    Include a mix of ratings and price points (Budget, Mid-range, Luxury) if appropriate for the destination.
    For each hotel, provide: Name, Address, Rating, Estimated Price, Amenities.
  expected_output: >
    A list of 5 hotels with details OR the error JSON.
  agent: hotel_scout


flight_task:
  description: >
    STEP 1: Check the 'feasibility_check' output. IF 'is_feasible' is false, RETURN THE ERROR JSON immediately.

    IF feasible:
    Identify direct and connecting flight routes to {destination} from {origin}.
    Provide at least 3 distinct options/airlines.
  expected_output: >
    A list of 3 flight options with airlines and duration OR the error JSON.
  agent: flight_expert


budget_task:
  description: >
    STEP 1: Check the 'feasibility_check' output.
    IF 'is_feasible' is false:
      Return the EXACT JSON output from the feasibility_check task.
      Do NOT change anything.

    IF feasible:
    Analyze the provided trip details: {trip_details}.
    1. Consolidate the flight options and hotel options.
    2. Estimate costs for each activity based on typical rates in Indian Rupees (INR).
    3. Ensure the plan fits within the total budget: {budget} INR.
    4. Compile the FINAL JSON output matching the structure exactly.
    5. For 'image_url' fields, logic MUST be: ALWAYS use the exact string "LEAVE_EMPTY_FOR_BACKEND". Do not try to generate a URL.
    6. Coordinates MUST be [latitude, longitude] numbers.
    
    CRITICAL: The 'itinerary' array in the JSON MUST contain EXACTLY {days} items.
    One item for each day from Day 1 to Day {days}.
    Do NOT miss any days. If the input has missing days, INFER them to complete the {days}-day trip.

  expected_output: >
    A strict JSON string matching the following structure (OR the error structure from feasibility_check):
    {
      "trip_name": "Trip to {destination}",
      "destination": "{destination}",
      "travel_style": "{travel_style}",
      "total_budget_estimated": "Amount in INR",
      "currency": "INR",
      "flights": [
        {
           "route": "City A to City B",
           "price_estimate": "Amount",
           "duration": "Duration",
           "airline_options": ["Airline 1", "Airline 2"]
        }
      ],
      "hotels": [
        {
           "name": "Hotel Name",
           "price_per_night": "Amount",
           "rating": "4.5/5",
           "features": ["Wifi", "Pool"],
           "image_url": "LEAVE_EMPTY_FOR_BACKEND",
           "coordinates": [0, 0],
           "address": "Street Address"
        }
      ],
      "itinerary": [
        {
           "day": 1,
           "theme": "Arrival & Exploration",
           "activities": [
             {
               "time": "10:00 AM",
               "activity": "Activity Name",
               "description": "Brief description",
               "cost_estimate": "Amount",
               "image_url": "LEAVE_EMPTY_FOR_BACKEND",
               "coordinates": [0, 0],
               "details": {
                  "famous_for": "Why it is famous",
                  "opening_hours": "09:00 - 17:00",
                  "best_time_to_visit": "Morning"
               }
             }
           ]
        }
      ]
    }
  agent: budget_guardian
  context: [enrichment_task, hotel_task, flight_task]
